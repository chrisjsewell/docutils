..                            -*- rst-mode -*-

Custom Roles
************

Excerpt from Docutils ``directives.txt`` documentation:

The "role" directive dynamically creates a custom interpreted text
role and registers it with the parser.  This means that after
declaring a role like this:

.. role:: custom

the document may use the new "custom" role:

An example of using :custom:`interpreted text`.

The new role may be based on an existing role, specified as a second
argument in parentheses (whitespace optional):

.. role:: custom2(emphasis)

More :custom2:`text`.

If no base role is explicitly specified, a generic custom role is
automatically used.  Subsequent interpreted text will produce an
"inline" element with a "classes" attribute, as in the first example
above.

With most roles, the ":class:" option can be used to set a "classes"
attribute that is different from the role name.  For example:

.. role:: custom3
   :class: special

More :custom3:`interpreted text`.

This can also be used to set several class names, for example:

.. role:: custom4
   :class: special custom exceptional

Special :custom4:`interpreted text`.


Rule names
==========

Rule names are stored in the document tree and passed on to writers as class
arguments.

HTML
 allows any kind of `#CDATA`__ ass class argument.

__ http://de.selfhtml.org/html/referenz/attribute.htm#cdata


CSS
 * selecting class names with the dot-syntax
   (``object.classname[.classname2[...]]``) restricts the allowed
   class names: [#]_

    * no spaces and special chars
    * may not start with a number or hyphen
    * no underbar '_'
    * not too long

 * selecting via object[class~=name] has no such restrictions.

.. [#] See http://de.selfhtml.org/css/formate/zentrale.htm#klassen

Docutils 
  allows attribut type NMTOKENS in classes__:

  NMTOKENS
      One or more space-separated NMTOKEN names.
  NMTOKEN
      A "name token". One or more of letters, digits, ".", "-", and "_".

__ http://docutils.sourceforge.net/docs/ref/doctree.html#classes


LaTeX 
  allows only letters in macro names that are used directly,
  Letters and hyphens are allowed if you use ``\csname ... \endcsname``

  Care must be taken to escape characters not allowed by LaTeX.

Test:

.. role:: custom5
   :class: custom5 custom.role my_custom custom-name 

Text with a :custom5:`special role`.

Results: 
  * Dots '.' and underbars '_' are translated to a hyphen '-' by
    Docutils (also in HTML export)
    
    .. note:: is this documented?
    
  * some class names cannot be used as LaTeX command name (hyphen,
    numbers), e.g. ``\docutilsrolemy-custom`` will result in an error
    
  * all resulting names work in ``\DUspan{classname}{content}``
