<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
  <title>PEP 9999 -- User Plugins for Docutils Readers/Writers</title>
  <style type="text/css">

/*
:Author: David Goodger
:Contact: goodger@python.org
:date: $Date$
:version: $Revision$
:copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the PEP HTML output of Docutils.
*/

/* "! important" is used here to override other ``margin-top`` and
   ``margin-bottom`` styles that are later in the stylesheet or 
   more specific.  See http://www.w3.org/TR/CSS1#the-cascade */
.first {
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.navigation {
  width: 100% ;
  background: #99ccff ;
  margin-top: 0px ;
  margin-bottom: 0px }

.navigation .navicon {
  width: 150px ;
  height: 35px }

.navigation .textlinks {
  padding-left: 1em ;
  text-align: left }

.navigation td, .navigation th {
  padding-left: 0em ;
  padding-right: 0em ;
  vertical-align: middle }

.rfc2822 {
  margin-top: 0.5em ;
  margin-left: 0.5em ;
  margin-right: 0.5em ;
  margin-bottom: 0em }

.rfc2822 td {
  text-align: left }

.rfc2822 th.field-name {
  text-align: right ;
  font-family: sans-serif ;
  padding-right: 0.5em ;
  font-weight: bold ;
  margin-bottom: 0em }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

body {
  margin: 0px ;
  margin-bottom: 1em ;
  padding: 0px }

dl.docutils dd {
  margin-bottom: 0.5em }

div.section {
  margin-left: 1em ;
  margin-right: 1em ;
  margin-bottom: 1.5em }

div.section div.section {
  margin-left: 0em ;
  margin-right: 0em ;
  margin-top: 1.5em }

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.footer {
  margin-left: 1em ;
  margin-right: 1em }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1 {
  font-family: sans-serif ;
  font-size: large }

h2 {
  font-family: sans-serif ;
  font-size: medium }

h3 {
  font-family: sans-serif ;
  font-size: small }

h4 {
  font-family: sans-serif ;
  font-style: italic ;
  font-size: small }

h5 {
  font-family: sans-serif;
  font-size: x-small }

h6 {
  font-family: sans-serif;
  font-style: italic ;
  font-size: x-small }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

img.borderless {
  border: 0 }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-family: sans-serif ;
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.option-argument {
  font-style: italic }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

td.num {
  text-align: right }

th.field-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body bgcolor="white">
<table class="navigation" cellpadding="0" cellspacing="0"
       width="100%" border="0">
<tr><td class="navicon" width="150" height="35">
<a href="http://www.python.org/" title="Python Home Page">
<img src="http://www.python.org/pics/PyBanner023.gif" alt="[Python]"
 border="0" width="150" height="35" /></a></td>
<td class="textlinks" align="left">
[<b><a href="http://www.python.org/">Python Home</a></b>]
[<b><a href="http://www.python.org/dev/peps/">PEP Index</a></b>]
[<b><a href="./pep-9999.txt">PEP Source</a></b>]
</td></tr></table>
<div class="document">
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">9999</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">User Plugins for Docutils Readers/Writers</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference" href="http://svn.python.org/view/*checkout*/peps/trunk/pep-9999.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Dave Kuhlman &lt;dkuhlman&#32;&#97;t&#32;rexx.com&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Active</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Informational</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference" href="http://www.python.org/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">12-Mar-2007</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">15-Mar-2007</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference" href="#abstract" id="id5">Abstract</a></li>
<li><a class="reference" href="#rationale" id="id6">Rationale</a></li>
<li><a class="reference" href="#the-proposal" id="id7">The Proposal</a></li>
<li><a class="reference" href="#alternatives" id="id8">Alternatives</a></li>
<li><a class="reference" href="#a-sample-implementation" id="id9">A Sample Implementation</a></li>
<li><a class="reference" href="#id1" id="id10">References</a></li>
<li><a class="reference" href="#copyright" id="id11">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id5">Abstract</a></h1>
<p>This proposal describes a standard for support of user directives for
Docutils readers/writers.  It is intended that Docutils writers (for
example, rst2html.py, rst2latex.py, rst2odt.py, etc.) would attempt to
load and register directives as described by this proposal.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id6">Rationale</a></h1>
<p>Directives are a Docutils extension mechanism.  In particular,
directives enable us to implement a class that adds nodes to the
document node tree as that tree is being constructed and before the
tree is processed by a writer.</p>
<p>This proposal describes a way to make directive implementations
automatically loadable.  It is intended that this mechanism would
enable users to add their own directives and even to provide different
directive implementations for different documents.</p>
</div>
<div class="section" id="the-proposal">
<h1><a class="toc-backref" href="#id7">The Proposal</a></h1>
<p>The following items describe this proposal:</p>
<ul class="simple">
<li>Each writer will attempt to import a directive module containing
directive implementation classes.</li>
<li>The default directive module name is <tt class="docutils literal"><span class="pre">docutils_directives.py</span></tt>.
Each writer will also implement a command line flag
<tt class="docutils literal"><span class="pre">--plugins-module-name</span></tt> that will enable users to override the
default directive module name.  But see note on problems with using
a command line flag below.</li>
<li>All classes in the directive module which contain the class variable
<tt class="docutils literal"><span class="pre">directive_name</span></tt> will be treated as directive implementation
classes.  Each such class will be registered as a directive using
the value of <tt class="docutils literal"><span class="pre">directive_name</span></tt> as the directive name.</li>
<li>Each directive implementation class must follow the directive class
implementation guidelines given at
<a class="reference" href="http://docutils.sourceforge.net/docs/howto/rst-directives.html">Creating reStructuredText Directives</a> <a class="footnote-reference" href="#id2" id="id3">[1]</a>.</li>
</ul>
<p>Notes:</p>
<ul>
<li><p class="first">I'd like users to be able to pass in the name of the plugins module
on the command line.  However, this seems difficult, because the
writer class, which has access to configuration variables, does not
get control until after the node tree has been constructed, and it
is during construction of the node tree that plugins (directive
classes) are run.</p>
</li>
<li><p class="first">The mechanism described above registers all classes in a module, if
the class has the class variable named <tt class="docutils literal"><span class="pre">directive_name</span></tt>.
Therefore, that module could &quot;include&quot; directive implementations
from other modules using the following:</p>
<pre class="literal-block">
from my_other_module import *
</pre>
<p>or:</p>
<pre class="literal-block">
from my_other_module import MyDirectiveClass1, MyDirectiveClass2
</pre>
</li>
<li><p class="first">This proposal supports the implementation of directives by <em>classes</em>
but not by <em>functions</em>.  But, I can't find any documentation on
implementing a directive as a function, anyway.  See:
<a class="reference" href="http://docutils.sourceforge.net/docs/howto/rst-directives.html">Creating reStructuredText Directives</a> <a class="footnote-reference" href="#id2" id="id4">[1]</a>.</p>
</li>
</ul>
</div>
<div class="section" id="alternatives">
<h1><a class="toc-backref" href="#id8">Alternatives</a></h1>
<p>Felix Wiemann also has a proposal for extensions.  That proposal seems
more oriented toward adding extensions to an installation of Docutils
rather than, as in this proposal, enabling users to load and register
directives automatically, on the fly.  So, for example, under Felix's
plugins proposal, in order to change the implementation of a
directive, the user must perform some sort of install operation.  Am I
right about that?</p>
<p>Felix's proposal also appears to be much more general and powerful
than this one.  It covers the ability to add other types of extensions
besides directives.  A quote from Felix's proposal:</p>
<blockquote>
&quot;Specifically, this document covers the addition of Docutils components
(readers, parsers, and writers), and the addition of reStructuredText
roles and directives.&quot;</blockquote>
<p>See:</p>
<ul class="simple">
<li><a class="reference" href="http://svn.berlios.de/viewcvs/docutils/branches/plugins/docs/howto/">http://svn.berlios.de/viewcvs/docutils/branches/plugins/docs/howto/</a></li>
<li>&quot;How To Create Extensions to Docutils&quot; --
<a class="reference" href="http://svn.berlios.de/viewcvs/docutils/branches/plugins/docs/howto/extensions.txt?view=markup">http://svn.berlios.de/viewcvs/docutils/branches/plugins/docs/howto/extensions.txt?view=markup</a></li>
</ul>
</div>
<div class="section" id="a-sample-implementation">
<h1><a class="toc-backref" href="#id9">A Sample Implementation</a></h1>
<p>The following code could be added near the top of a Docutils writer in
order to implement this proposal.  This code is provided for
discussion.  Note that it does not support a command line flag that
can pass in the directive module name.</p>
<pre class="literal-block">
import inspect

#
# Register directives defined in a module named &quot;odtwriter_plugins&quot;.
#
def load_plugins():
    plugin_mod = None
    count = 0
    try:
        import odtwriter_plugins
        plugin_mod = odtwriter_plugins
    except ImportError, e:
        pass
    if plugin_mod is None:
        return count
    klasses = inspect.getmembers(plugin_mod, inspect.isclass)
    for klass in klasses:
        if register_plugin(*klass):
            count += 1
    return count

def register_plugin(name, klass):
    plugin_name = getattr(klass, 'plugin_name', None)
    if plugin_name is not None:
        rst.directives.register_directive(plugin_name, klass)

load_plugins()
</pre>
</div>
<div class="section" id="id1">
<h1><a class="toc-backref" href="#id10">References</a></h1>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id3">1</a>, <a class="fn-backref" href="#id4">2</a>)</em> <a class="reference" href="http://docutils.sourceforge.net/docs/howto/rst-directives.html">http://docutils.sourceforge.net/docs/howto/rst-directives.html</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id11">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
</div>

</div>
</body>
</html>
