{% extends "admin/layout.html" %}
{% block admin_body %}
  <h1>Manage Users</h1>
  <form action="" method="post">
    {% if ask_confirmation %}
      <div class="dialog">
        <h2>Confirm</h2>
        <div class="text">
          {% trans amount=to_delete|length, first_user=to_delete[0]|e,
                   all_users=to_delete|join(', ')|e %}
            Do you really want to delete the user {{ first_user }}?
          {% pluralize %}
            Do you really want to delete the {{ amount }} users
            {{ all_users }}?
          {% endtrans %}
        </div>
        <div class="buttons">
          <input type="hidden" name="update" value="yes">
          <input type="submit" name="confirmated" value="Yes">
          <input type="submit" name="aborted" value="No">
        </div>
      </div>
    {% endif %}
    {% if generated_user and generated_password %}
    <div class="dialog">
      <h2>User Generated</h2>
      <div class="text">
        The user <strong>{{ generated_user|e }}</strong> was generated successfully
        with the password <strong>{{ generated_password|e }}</strong>.
      </div>
    </div>
    {% endif %}
    {% if self_destruction %}
    <div class="dialog">
      <h2>Error</h2>
      <div class="text">
        You can't delete your own user or remove your own master privileges.
      </div>
    </div>
    {% endif %}
    {% if add_user_mode %}
    <div class="dialog detail_form">
      <h2>Add User</h2>
      <div class="text">
        Username <input type="text" size="24" name="username" value="{{
          form.username|e(true) }}">
      </div>
      <div class="buttons">
        <input type="submit" name="add_user" value="Add">
        <input type="submit" name="aborted" value="Cancel">
      </div>
    </div>
    {% endif %}
    <table class="mapping">
      <tr>
        <th>Username</th>
        <th>Privileges</th>
        <th class="actions">Delete</th>
      </tr>
      {%- for user, privileges in users|dictsort %}
      <tr>
        <td class="username">{{ user|e }}</td>
        <td class="groups"><input type="text" name="privileges-{{ user|e }}" value="{{ privileges|join(', ') }}"></td>
        <td class="actions"><input type="checkbox" name="delete" value="{{ user|e
        }}"{% if user in to_delete %} checked{% endif %}></td>
      </tr>
      {%- endfor %}
    </table>
    <div class="actions">
      <input type="submit" name="update" value="Update">
      <input type="submit" name="add_user" value="Add User">
      <input type="submit" name="cancel" value="Cancel">
    </div>
  </form>
{% endblock %}
