#!/bin/sh
#
# Author: Engelbert Gruber <grubert@users.sf.net>
# Copyright: This module has been placed in the public domain.

IN_DIR=input
OUT_DIR=output
EXP_DIR=expected

if [ "$1" = "create" ] ; then
  CREATE=1
fi

TMPF_OUT=diff-out.tmp.$$
TMPF_EXP=diff-exp.tmp.$$
for IN_F in $IN_DIR/*.txt ; do
    BASE=`basename $IN_F`
    F_BASE=${BASE%.txt}
    TMPF=$BASE.$$.diff
	echo "File: $BASE" > $TMPF_EXP
	grep -v "Generated by docutils manpage writer on" $EXP_DIR/$F_BASE.man >> $TMPF_EXP
	grep -v "Generated by docutils manpage writer on" $OUT_DIR/$F_BASE.man > $TMPF_OUT
    diff -s -u $TMPF_EXP $TMPF_OUT > $TMPF
	if test $? -gt 0 ; then
		less $TMPF
		if [ "$CREATE" = "1" ] ; then
			cp $OUT_DIR/$F_BASE.man $EXP_DIR
		fi
	fi
    rm $TMPF
done
rm $TMPF_OUT $TMPF_EXP
